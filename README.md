# Lua GLR Parser (é€šç”¨LRè§£æå™¨)

è¿™æ˜¯ä¸€ä¸ªç”¨çº¯ Lua 5.3 å®ç°çš„æ¨¡å—åŒ– GLR (Generalized Left-to-right Rightmost derivation) è§£æå™¨ã€‚å®ƒæ”¯æŒå¤šç§æ–‡æ³•ç±»å‹ï¼ŒåŒ…æ‹¬è‡ªå®šä¹‰çš„ Lua å­é›†ï¼ˆå¸¦æœ‰ `global` å…³é”®å­—æ‰©å±•ï¼‰ã€æ•°å­¦è¡¨è¾¾å¼ä»¥åŠç®€å•çš„ç¼–ç¨‹è¯­è¨€ç»“æ„ã€‚æ­¤å¤–ï¼Œå®ƒè¿˜æ”¯æŒä»è§£ææ ‘é‡å»ºæºä»£ç ï¼ˆRenderingï¼‰ã€‚

## âœ¨ ä¸»è¦ç‰¹æ€§

- **çº¯ Lua å®ç°**ï¼šä»…ä¾èµ– Lua 5.3+ åŸç”Ÿåº“ï¼Œæ— å¤–éƒ¨ä¾èµ–ã€‚
- **æ¨¡å—åŒ–æ¶æ„**ï¼šæ¸…æ™°çš„ä»£ç ç»„ç»‡ï¼Œä¾¿äºæ‰©å±•å’Œç»´æŠ¤ã€‚
- **å¤šç§æ–‡æ³•æ”¯æŒ**ï¼š
    - âœ… **Lua æ‰©å±•æ–‡æ³•**ï¼šæ”¯æŒæ ‡å‡† Lua è¯­æ³•å­é›†ï¼Œå¹¶å¢åŠ äº† `global` å…³é”®å­—ã€‚
    - âœ… **æ•°å­¦è¡¨è¾¾å¼**ï¼šæ”¯æŒåŸºæœ¬çš„ç®—æœ¯è¿ç®—å’Œä¼˜å…ˆçº§ã€‚
    - âœ… **ç®€å•æ–‡æ³•**ï¼šç”¨äºæµ‹è¯•å’Œæ¼”ç¤ºçš„åŸºæœ¬é€’å½’æ–‡æ³•ã€‚
    - âœ… **ç¼–ç¨‹è¯­è¨€æ–‡æ³•**ï¼šé€šç”¨çš„ç¼–ç¨‹è¯­è¨€ç»“æ„ç¤ºä¾‹ã€‚
- **GLR ç®—æ³•**ï¼šèƒ½å¤Ÿå¤„ç†äºŒä¹‰æ€§æ–‡æ³•ï¼ˆé€šè¿‡ç”Ÿæˆè§£ææ£®æ—ï¼Œå°½ç®¡ç›®å‰ä¸»è¦å±•ç¤ºå•ä¸€è§£ææ ‘ï¼‰ã€‚
- **æºä»£ç é‡å»º (Rendering)**ï¼šæ”¯æŒå°†è§£ææ ‘è¿˜åŸä¸ºæºä»£ç ï¼Œå¯ç”¨äºä»£ç æ ¼å¼åŒ–æˆ–è½¬æ¢å·¥å…·çš„åŸºç¡€ã€‚
- **è‡ªåŠ¨æœºæ„å»º**ï¼šå®Œæ•´çš„ LR(1) è‡ªåŠ¨æœºç”Ÿæˆï¼ŒåŒ…å« FIRST/FOLLOW é›†è®¡ç®—ã€‚

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- Lua 5.3 æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚
- Git (ç”¨äºå…‹éš†ä»“åº“)ã€‚

### å®‰è£…ä¸éªŒè¯

1.  å…‹éš†æœ¬ä»“åº“ï¼š
    ```bash
    git clone https://github.com/your-username/lua-glr-parser.git
    cd lua-glr-parser
    ```

2.  è¿è¡ŒéªŒè¯è„šæœ¬ï¼ˆå°†è‡ªåŠ¨æ‹‰å– Lua æºç å¹¶ç¼–è¯‘ï¼Œè¿è¡Œæµ‹è¯•ï¼‰ï¼š
    ```bash
    ./setup_and_verify.sh
    ```

### å‘½ä»¤è¡Œä½¿ç”¨ (CLI)

é¡¹ç›®æä¾›äº†ä¸€ä¸ªå¼ºå¤§çš„å‘½ä»¤è¡Œå·¥å…· `run_parser.lua`ï¼Œç”¨äºè§£ææ–‡ä»¶æˆ–ç”Ÿæˆè¿˜åŸä»£ç ã€‚

**åŸºæœ¬ç”¨æ³•ï¼š**

```bash
lua run_parser.lua [--render|-r] [grammar_type] <input_file> [output_file]
```

**å‚æ•°è¯´æ˜ï¼š**

- `--render` / `-r`ï¼šå¯é€‰ã€‚å¦‚æœæŒ‡å®šï¼Œå°†è¾“å‡ºä»è§£ææ ‘é‡å»ºçš„æºä»£ç ï¼ˆè€Œä¸æ˜¯è§£ææ ‘ç»“æ„ï¼‰ã€‚
- `grammar_type`ï¼šæŒ‡å®šä½¿ç”¨çš„æ–‡æ³•ç±»å‹ã€‚
    - `lua` (é»˜è®¤)ï¼šLua æ‰©å±•æ–‡æ³•ã€‚
    - `math`ï¼šæ•°å­¦è¡¨è¾¾å¼æ–‡æ³•ã€‚
    - `simple`ï¼šç®€å•æµ‹è¯•æ–‡æ³•ã€‚
    - `programming`ï¼šé€šç”¨ç¼–ç¨‹è¯­è¨€æ–‡æ³•ã€‚
- `input_file`ï¼šè¾“å…¥æºä»£ç æ–‡ä»¶è·¯å¾„ã€‚
- `output_file`ï¼šå¯é€‰ã€‚è¾“å‡ºç»“æœçš„æ–‡ä»¶è·¯å¾„ã€‚å¦‚æœä¸æŒ‡å®šï¼Œå°†æ‰“å°åˆ°æ ‡å‡†è¾“å‡ºã€‚

**ç¤ºä¾‹ï¼š**

1.  **è§£æ Lua æ–‡ä»¶å¹¶æ‰“å°è§£ææ ‘ï¼š**
    ```bash
    lua run_parser.lua lua test_parser_features.lua
    ```

2.  **è§£æ Lua æ–‡ä»¶å¹¶è¿˜åŸä»£ç  (Rendering)ï¼š**
    ```bash
    lua run_parser.lua --render lua test_parser_features.lua output.lua
    ```
    *(æ³¨ï¼šå¦‚æœä½ æ²¡æœ‰ç³»ç»Ÿå®‰è£… Luaï¼Œè¯·ä½¿ç”¨ `./tmp_lua/lua` ä»£æ›¿ `lua`ï¼Œå‰ææ˜¯è¿è¡Œè¿‡ `setup_and_verify.sh`)*

### åº“ä½¿ç”¨ (API)

ä½ ä¹Ÿå¯ä»¥åœ¨ Lua ä»£ç ä¸­ç›´æ¥ä½¿ç”¨æœ¬è§£æå™¨ã€‚

```lua
local GLR = require("GLR")

-- 1. åˆ›å»ºè§£æå™¨å®ä¾‹ (ä¾‹å¦‚ä½¿ç”¨ Lua æ–‡æ³•)
local parser = GLR.create_lua_grammar()

-- 2. æ„å»ºè‡ªåŠ¨æœº
parser:build()

-- 3. è§£æè¾“å…¥ä»£ç 
local code = [[
local function fact(n)
    if n == 0 then return 1 else return n * fact(n-1) end
end
]]
local success, result = pcall(function() return parser:parse(code) end)

if success and result then
    -- 4. æ‰“å°è§£ææ ‘
    parser:print_tree(result[1])

    -- 5. è¿˜åŸæºä»£ç 
    print("\nRendered Code:")
    print(parser:render(result[1]))
else
    print("Parse Failed")
end
```

æ›´å¤šç¤ºä¾‹è¯·å‚è€ƒ `final_demo.lua` å’Œ `reproduce_global.lua`ã€‚

## ğŸ“ é¡¹ç›®ç»“æ„

```
.
â”œâ”€â”€ core/                   # æ ¸å¿ƒè§£æé€»è¾‘
â”‚   â”œâ”€â”€ Grammar.lua        # æ–‡æ³•å®šä¹‰
â”‚   â”œâ”€â”€ LuaGrammar.lua     # Lua æ–‡æ³•å…·ä½“å®ç°
â”‚   â”œâ”€â”€ Automaton.lua      # è‡ªåŠ¨æœºæ„å»º
â”‚   â””â”€â”€ ...
â”œâ”€â”€ parsing/                # è§£æè¿è¡Œæ—¶
â”‚   â”œâ”€â”€ Parser.lua         # GLR è§£æå™¨å®ç°
â”‚   â””â”€â”€ ...
â”œâ”€â”€ utils/                  # å·¥å…·ç±»
â”‚   â”œâ”€â”€ Tokenizer.lua      # åˆ†è¯å™¨
â”‚   â””â”€â”€ ...
â”œâ”€â”€ GLR.lua                 # ä¸»å…¥å£æ–‡ä»¶
â”œâ”€â”€ run_parser.lua          # å‘½ä»¤è¡Œå·¥å…·
â”œâ”€â”€ setup_and_verify.sh     # ç¯å¢ƒå®‰è£…ä¸éªŒè¯è„šæœ¬
â”œâ”€â”€ test_parser_features.lua# æµ‹è¯•ç”¨ä¾‹
â”œâ”€â”€ CONTRIBUTING.md         # è´¡çŒ®æŒ‡å—
â”œâ”€â”€ CODE_OF_CONDUCT.md      # è¡Œä¸ºå‡†åˆ™
â”œâ”€â”€ LICENSE                 # è®¸å¯è¯
â””â”€â”€ README.md               # é¡¹ç›®æ–‡æ¡£
```

## ğŸ¤ è´¡çŒ® (Contributing)

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼è¯¦ç»†ä¿¡æ¯è¯·é˜…è¯» [CONTRIBUTING.md](CONTRIBUTING.md)ã€‚

## ğŸ“œ è®¸å¯è¯ (License)

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ã€‚è¯¦æƒ…è¯·å‚é˜… [LICENSE](LICENSE) æ–‡ä»¶ã€‚
